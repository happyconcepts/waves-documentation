# Формула расчета рейтинга

Рейтинг токена есть суточное средневзвешенное значение отдельных оценок всех пользователей, когда либо оценивавших этот токен:

R = (R<sub>1</sub>W<sub>1</sub> + R<sub>2</sub>W<sub>2</sub> + ... + R<sub>n</sub>W<sub>n</sub>) / (W<sub>1</sub> + W<sub>2</sub> + ... + W<sub>n</sub>),

где

R<sub>n</sub> — оценка n-го пользователя,

W<sub>n</sub> — вес оценки n-го пользователя.

Полученное значение `R` округляется до десятых долей числа.

## Оценка пользователя R<sub>n</sub>

Пользователь выставляет оценку токену R<sub>n</sub> внутри карточки токена при помощи звездочек и кнопки **Оценить**. R<sub>n</sub> принимает целые значения от 1 до 5 включительно.

Пользователь может оценивать один и тот же токен много раз — в расчет будет браться самая последняя оценка.

Пользователь может оценить любой токен из браузера, в котором установлен [Waves Keeper](/waves-keeper/about-waves-keeper.md), если на балансе его аккаунта не меньше 1 [WCT](/blockchain/token/wct.md). Токены WCT при оценке не списываются, но их количество влияет на W<sub>n</sub>.

## Вес оценки пользователя W<sub>n</sub>

Величина W<sub>n</sub> рассчитывается по формуле:

W<sub>n</sub> = B<sub>n</sub>k<sub>n</sub>,

где

B<sub>n</sub> — эффективный баланс n-го пользователя в токенах WCT,

k<sub>n</sub> — весовой коэффициент n-го пользователя.

Полученное значение W<sub>n</sub> округляется до целого числа.

## Эффективный баланс пользователя B<sub>n</sub>

Эффективный баланс B<sub>n</sub> — это баланс токенов WCT на момент выставления оценки, минус сумма всех расходных операций в WCT в течение следующих 24 часов.

Если B<sub>n</sub> < 1, то оценка не будет учитываться при расчете рейтинга токена.

## Весовой коэффициент пользователя k<sub>n</sub>

Величина коэффициента k<sub>n</sub> зависит от величины эффективного баланса B<sub>n</sub> оценивающего и рассчитывается по формуле:

|Величина эффективного баланса B<sub>n</sub> оценивающего|Значение весового коэффициента k<sub>n</sub>|
| --- | --- |
| 1 — 10 | B<sub>n</sub> |
| 11 — 150 000 | – 0,091 × ln(B<sub>n</sub>) + 1,20958 |
| 150 001 — 540 000 |(– 0,00019 × B<sub>n</sub> + 153) / 1000 |
| 540 001 — ∞ | 0,05 |

Полученное значение k<sub>n</sub> округляется до сотых долей числа.

## Пример расчета рейтинга токена

**Пользователь 1** оценил токен в 5 звезд. На момент голосования на его балансе было 10 000 WCT.

За 24 часа было 3 операции: расход 300 WTC, расход 200 WTC и доход 500 WTC. Получается, расходные операции составляют 300 + 200 = 500 WTC. Таким образом 9 500 WCT — это эффективный баланс B<sub>1</sub> (несмотря на то что на балансе через 24 часа остались те же 10 000 WCT, что и на момент выставления оценки).

B<sub>1</sub> находится в промежутке 11 — 150 000, значит рассчитываем k<sub>1</sub> по формуле:

k<sub>1</sub> = -0,091 × ln(9 500) + 1,20958 = 0,38

Вес оценки:

W<sub>1</sub> = B<sub>1</sub> × k<sub>1</sub> = 9 500 × 0,38 = 3 610

Итого: токен получил от пользователя 1 оценку 5 с весом 3 610.

**Пользователь 2** оценил тот же токен в 4 звезды. На момент голосования на его балансе было 7 WCT.

За 24 часа расходных операций не было, значит эффективный баланс B<sub>2</sub> равен 7 WCT.

B<sub>2</sub> находится в промежутке 1 — 10, в этом случае:

k<sub>2</sub> = 7

Вес оценки:

W<sub>2</sub> = B<sub>2</sub> × k<sub>2</sub> = 7 × 7 = 49

Итого: токен получил от пользователя 2 оценку 4 с весом 49.

Рейтинг `R` токена будет рассчитываться как средневзвешенное значение оценок, выставленных обоими пользователями:

R = (5 × 3 610 + 4 × 49) / (3 610 + 49) = 4,987 (округляется до 5,0)

Количество WCT, выставивших оценку 5 будет 3 610, оценку 4 — 49:

<img src="img/rating.png" alt="faucet" width="350"/>
